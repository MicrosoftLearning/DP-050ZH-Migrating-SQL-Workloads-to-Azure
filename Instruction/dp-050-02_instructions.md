# DP 050 – 将 SQL 工作负载迁移到 Azure

# 实验室 2 - 为数据迁移选择合适的工具

**预计用时**： 25 分钟

**先决条件**： 没有用于执行此实验室的先决条件步骤。

**实验室文件**： 这个实验室没有实验室文件

## 实验室概述

学生将在规定的数据平台现代化阶段使用数据迁移助手以自动方式研究环境。他们还将识别任何迁移前兼容性问题，并在执行本地服务器迁移之前制定有关如何解决这些问题的计划。最后，他们将评估工作负载在 Azure SQL 数据库的目标版本上的执行情况。

## 实验室目标
  
完成本实验室后，你将能够：

1. 使用数据迁移助手确定迁移候选项

## 应用场景
  
你是 AdventureWorks 的高级数据工程师，正在为数据现代化项目做准备。首先，你将使用工具执行环境中存在的 SQL Server 清单。然后，你将对服务器进行评估，以确定在进行任何现代化工作之前需要解决的任何问题。其中一个本地 SQL Server 用于处理公司的销售，并且你希望确保新的 Azure 服务在迁移后可以支持你的工作负载。

## 练习 1：使用数据迁移助手确定迁移候选项
  
在本练习中，你将使用数据迁移助手查找 SQL Server 和 Azure SQL 数据库之间的 SQL Server 功能奇偶一致性和兼容性问题。

预计用时：20 分钟
  
本练习的主要任务是：

1. 在 Windows 上安装数据迁移助手 (DMA)。
1. 使用数据迁移助手。

### 在 Windows 上安装数据迁移助手 (DMA)

> [注意！]
> 即使已安装 DMA，也请按照本任务中的步骤进行操作，以确保使用的是该工具的最新版本。

1. 登录到在教室环境中运行的 **LON-DEV-01** 虚拟机。用户名是 **“administrator”**，密码为 **“Pa55w.rd”**。
1. 打开 Web 浏览器，然后转到 Microsoft 数据迁移助手的下载页，即 +++https://www.microsoft.com/download/details.aspx?id=53595+++。
1. 通过检查要求列表，确认你的环境是否支持该软件。
1. 若要下载 **DataMigrationAssistant.msi**，请依次选择 **“下载”** 和 **“运行”**。
1. 在 **“欢迎”** 屏幕上，选择 **“下一步”**。
1. 选择 **“我接受许可协议中的条款”**，然后选择 **“下一步”**。
1. 阅读 **“隐私声明”**，然后选择 **“安装”**。
1. 如果收到提示，则允许对此应用程序进行 UAC 控制。
1. 若要完成安装，请选择 **“完成”**。

### 使用数据迁移助手为从 SQL Server 迁移到 Azure SQL 数据库做好准备

1. 选择 **“开始”** 按钮，键入 **“数据迁移”**，然后选择 **“Microsoft 数据迁移助手”**。
1. 若要新建项目，请选择左侧的 **“+”**。
1. 在 **“新建”** 页上，输入以下值，然后选择 **“创建”**：

    | 属性 | 值 |
    | --- | --- |
    | 项目类型 | 评估 |
    | 项目名称 | +++迁移评估 SQL DB+++ |
    | 评估类型 | 数据库引擎 |
    | 源服务器类型 | SQL Server |
    | 目标服务器类型 | Azure SQL 数据库 |

1. 在 **“选项”** 页面上，保留默认值，然后选择 **“下一步”**。
1. 在 **“连接到服务器”** 页上，输入以下值，然后选择 **“连接”**：

    | 属性 | 值 |
    | --- | --- |
    | 服务器名称 | localhost |
    | 身份验证类型 | Windows 身份验证 |
    | 加密连接 | 已取消选中 |
    | 信任服务器证书 | 已选中 |

1. 在 **“添加源”** 页上，选择 **“AdventureWorks”** 数据库，然后选择 **“添加”**。
1. 在 **“选择源”** 页上，选择 **“开始评估”**。
1. 查看找到的 SQL Server 功能奇偶一致性和兼容性问题。请注意功能奇偶校验问题的数量。

### 使用数据迁移助手为从 SQL Server 迁移到 Azure SQL 数据库托管实例做好准备

1. 若要新建项目，请选择左侧的 **“+”**。
1. 在 **“新建”** 页上，输入以下值，然后选择 **“创建”**：

    | 属性 | 值 |
    | --- | --- |
    | 项目类型 | 评估 |
    | 项目名 | +++迁移评估 SQL DB MI+++ |
    | 评估类型 | 数据库引擎 |
    | 源服务器类型 | SQL Server |
    | 目标服务器类型 | Azure SQL 数据库托管实例 |

1. 在 **“选项”** 页面上，保留默认值，然后选择 **“下一步”**。
1. 在 **“连接到服务器”** 页上，输入以下值，然后选择 **“连接”**：

    | 属性 | 值 |
    | --- | --- |
    | 服务器名称 | localhost |
    | 身份验证类型 | Windows 身份验证 |
    | 加密连接 | 取消选中 |
    | 信任服务器证书 | 选中 |

1. 在 **“添加源”** 页上，选择 **“AdventureWorks”** 数据库，然后选择 **“添加”**。
1. 在 **“选择源”** 页上，选择 **“开始评估”**。
1. 查看找到的 SQL Server 功能奇偶一致性和兼容性问题。请注意功能奇偶一致性问题的数量。

### 使用数据迁移助手为从 SQL Server 迁移到 Azure 虚拟机上的 SQL Server 做好准备

1. 若要新建项目，请选择左侧的 **“+”**。
1. 在 **“新建”** 页上，输入以下值，然后选择 **“创建”**：

    | 属性 | 值 |
    | --- | --- |
    | 项目类型 | 评估 |
    | 项目名 | +++迁移评估 Azure VM+++ |
    | 评估类型 | 数据库引擎 |
    | 源服务器类型 | SQL Server |
    | 目标服务器类型 | Azure 虚拟机上的 SQL Server |

1. 在 **“选项”** 页面上，保留默认值，然后选择 **“下一步”**。
1. 在 **“连接到服务器”** 页上，输入以下值，然后选择 **“连接”**：

    | 属性 | 值 |
    | --- | --- |
    | 服务器名称 | localhost |
    | 身份验证类型 | Windows 身份验证 |
    | 加密连接 | 取消选中 |
    | 信任服务器证书 | 选中 |

1. 在 **“添加源”** 页上，选择 **“AdventureWorks”** 数据库，然后选择 **“添加”**。
1. 在 **“选择源”** 页上，选择 **“开始评估”**。
1. 查看找到的 SQL Server 功能奇偶一致性和兼容性问题。请注意功能奇偶一致性问题的数量。

完成此练习后，你已收集有关在 SQL Server 本地实例与 Azure 中各种 SQL Server 托管选项之间发现的 SQL Server 功能奇偶校验和兼容性问题的信息。

## 实验室回顾

大约 20 分钟后，讲师将结束此实验室。班级将讨论每个组的检测结果。