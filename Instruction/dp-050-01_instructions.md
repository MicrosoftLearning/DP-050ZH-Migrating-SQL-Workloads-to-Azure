# DP 050 – 将 SQL 工作负载迁移到 Azure
# 实验室 1 - Azure 体系结构注意事项

**预计用时**： 50 分钟

**先决条件**： 没有用于执行此实验室的先决条件步骤。

**实验室文件**： 此实验室的文件位于 _Allfiles\Labfiles\Starter\DP-150.1_ 文件夹中。

## 实验室概述

学生将使用本模块中获得的信息来展示对数据平台现代化的理解，以及组织为何及如何在高层次上实施现代化项目。他们将学习如何确定迁移到 Azure 的成本。他们还将收集与正在处理的环境有关的信息。学生将最终确定应该用于给定场景的数据平台现代化策略。

## 实验室目标
  
完成本实验室后，你将能够：

- 说明数据平台现代化。
- 列出迁移阶段。
- 说明数据迁移技术。

## 应用场景
  
你最近被聘为 AdventureWorks 的高级数据工程师，并正在与顾问和架构师合作，启动满足组织技术和业务要求的数据平台现代化项目。你将计算迁移到 Azure 的总拥有成本 (TCO)。你将要求初级数据工程师收集有关将迁移到 Azure 的 SQL Server 的信息。然后，你将根据给定的场景选择要迁移到的最佳的 Azure 数据平台技术。

## 练习 1：了解数据平台现代化

在本实验室中，你将计算将数据库迁移到 Azure 的成本。

预计用时：15 分钟

本练习的主要任务是：

1. 打开 Microsoft 总拥有成本 (TCO) 计算器
1. 定义基于服务器的工作负载
1. 添加存储
1. 添加网络
1. 调整货币
1. 调整电力成本
1. 调整其他假设
1. 比较本地和 Azure 成本

### 打开总拥有成本 (TCO) 计算器

1. 打开浏览器并导航到 Azure TCO 计算器，即 +++https://azure.microsoft.com/pricing/tco/calculator/+++。
1. 在 **“定义工作负载”** 下，删除 **“服务器”** 部分中的所有现有工作负载。

### 输入数据库工作负载

1. 在 **“数据库”** 下，删除所有现有工作负载。
1. 选择 **“+ 添加数据库”**。
1. 在 **“名称”** 文本框中，键入 **“Accounting”**。
1. 在 **“源”** 部分中，选择以下值：

    | 属性 | 值 |
    | --- | --- |
    | 数据库 | Microsoft SQL Server |
    | 许可 | 企业 |
    | 环境 | 物理服务器 |
    | 操作系统 | Windows |
    | 操作系统许可证 | 数据中心 |
    | 服务器 | 1 |
    | 每个服务器的进程 | 1 |
    | 每个进程的核心 | 4 |
    | RAM (GB) | 64 |
    | 优化方式 | CPU |
    | SQL Server 2008/2008R2 | 向右滑动 |

1. 在 **“目标”** 部分中，选择以下值：

    | 属性 | 值 |
    | --- | --- |
    | 服务 | SQL Server VM |
    | 磁盘类型 | SSD |
    | IOPS | 5000 |
    | SQL Server 存储 | 32 GB |
    | SQL Server 备份 | 32 GB |

    > [注意！]
    > SSD 是适用于 Azure 中的生产服务器的推荐磁盘类型

### 输入存储和网络工作负载

1. 在 **“存储”** 下，删除所有现有工作负载，然后选择 **“+ 添加存储”**。
1. 输入以下值：

    | 属性 | 值 |
    | --- | --- |
    | 名称 | Accounting 本地磁盘 |
    | 存储类型 | 本地磁盘/SAN |
    | 磁盘类型 | HDD |
    | 容量 | 3 TB |
    | 备份 | 1 TB |
    | 存档 | 0 TB |

1. 在 **“网络”** 下的 **“出站带宽”** 控件中，选择 **“1 GB”**。
1. 在页面底部，选择 **“下一步”**。

### 调整假设

1. 在 **“调整假设”** 部分的 **“货币”** 列表中，选择首选货币。
1. 在 **“软件保障范围(提供 Azure 混合权益)”** 下，向右滑动 **“Windows Server 软件保障范围”** 滑块。
1. 向右滑动 **“SQL Server 软件保障范围”** 滑块。

    > [注意！]
    > 可以访问 **“软件保障”** 部分中的链接，详细了解可用的保障。后续部分中有类似的链接。

1. 在 **“异地冗余存储 (GRS)”** 下，确保关闭 **“GRS 将数据复制到距主区域数百英里以外的辅助区域”** 旁的切换开关。
1. 在 **“虚拟机成本”** 下，确保关闭 **“为计算器启用此功能，且不建议使用 B 系列虚拟机”** 旁边的切换开关。
1. 在 **“电费”** 下的 **“每千瓦时价格”** 文本框中，输入你所在位置的实际数值。

    > [注意！]
    > 可以在[全球电价](https://www.statista.com/statistics/263492/electricity-prices-in-selected-countries/)中查看大致的电价。所有价格以美元 ($) 为单位。将其换算为以首选货币为单位的近似值。

1. 在 **“存储成本”** 下，保留应用中的默认值。
1. 在 **“IT 人力成本”** 下，保留所有默认值。
1. 在 **“其他假设”** 下，展开每个部分并查看相关成本。
1. 在页面底部，选择 **“下一步”**。

### 研究 5 年期报表

1. 在 **“查看报表”** 页中，注意 **“时间范围”** 默认为 **“5 年”**。
1. 向下滚动以显示报表，并注意本地系统相较于 Azure 的预估成本。记录此信息：

    - 本地工作负载的大部分支出用在哪里？
    - 如果决定迁移到 Azure，那么最大的成本节约在哪个部分？

1. 依次展开每个部分并研究成本明细。
1. 根据所在位置、网络延迟或数据主权要求更改区域，并查看成本对比。

### 研究 3 年期报表

1. 滚动到页面顶部，然后在 **“时间范围”** 文本框中，选择 **“3 年”**。
1. 向下滚动报表并研究预估的本地系统和 Azure 成本明细。记录此信息：

    - 本地的大部分支出用在哪里？
    - 如果决定迁移到 Azure，那么最大的成本节约在哪个部分？

1. 依次展开每个部分并研究成本明细

完成本练习后，你已使用 Azure TCO 计算器识别 AdventureWorks Corporation 的 accounting 服务器及其关联数据库的本地和 Azure 部署之间的成本差异。

## 练习 2：了解迁移的各个阶段

在本练习中，你将检查现有服务器的规格。

预计用时：15 分钟

本练习的主要任务是：

1. 确定现有服务器使用的内存量
1. 发现现有服务器的 CPU 类型
1. 确定现有服务器的磁盘配置

### 确定服务器上正在使用的内存量

1. 登录到在教室环境中运行的 **LON-DEV-01** 虚拟机。用户名是 **“administrator”，密码为“Pa55w.rd”**。
1. 使用你所选的方法以确定服务器上正在使用的内存量。

    > **提示**： 使用 System Information（Windows 的所有新式版本中均包含该应用程序）获取有关服务器或桌面设备的规范。若要打开 System Information，请选择“开始”，然后在搜索字段中输入“System Information”。

1. 在记事本上记录此值。

### 确定服务器上正在使用的 CPU 的数量

1. 使用你所选的方法确定服务器上正在使用的 CPU 资源量。
1. 在记事本上记录你的观察结果。

### 确定服务器上正在使用的磁盘配置

1. 使用你所选的方法确定服务器上配置的磁盘配置。
1. 在记事本上记录配置。
1. 将记事本以 ServerSpecs.txt 为名称保存到 _Allfiles\Labfiles\Starter\DP-150.1_ 文件夹中

完成本练习后，你已收集有关服务器硬件规格的信息。

## 练习 3：数据迁移技术

在本练习中，你将选择一种数据平台技术来帮助客户从本地 SQL Server 迁移到 Azure。

预计用时：15 分钟

本练习的任务如下所示：

1. 确定方案 A 中促进迁移所需的数据库技术。
1. 确定方案 B 中促进迁移所需的数据库技术。

### 确定方案 A 中促进迁移所需的数据库技术

1. 阅读以下方案

      客户的应用程序使用当前驻留在 Microsoft SQL Server 2008 本地版本中的许多数据库。数据库总占用情况较大，为 12 TB 且以每年数个 TB 的速率快速增长。该应用程序还具有与 SQL Server Reporting Services 的紧密集成，以便提供报告功能。现有 SAN 存储（其中包含数据库）几乎达到满负荷，扩展成本高，并且其使用寿命接近到期。该应用程序对公司至关重要，事务率适中，任何故障时间都会对业务产生重大影响。可以使用小型维护窗口进行更改，以最大限度地提高应用程序的可用性。高增长率已经让 DBA 和 sysadmin 花费越来越多的时间来保持一切正常运转。

1. 在此场景中，哪种数据库平台技术是合适的？

### 确定方案 B 中促进迁移所需的数据库技术

1. 阅读以下方案

      客户将部门数据保存在具有 16 GB 内存的四核 SQL Server 上的数据库中。该服务器用作电子表格和 Access 表单的简单数据访问的后端。数据库总共六个，共占用 350 MB 的存储。此服务器的并发连接上限为 12 个。

1. 在此场景中，哪种数据库平台技术是合适的？

完成此练习后，你已为迁移项目确定了适合的 Azure 数据库技术。

## 实验室回顾

大约 45 分钟后，讲师将结束此实验室。班级将讨论每个组的检测结果。